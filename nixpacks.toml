# Nixpacks configuration for Railway monorepo deployment
# Optimized for Node.js 20 LTS with system Chromium for Puppeteer
# Last updated: 2025-12-19 - Force rebuild for @types/uuid

[phases.setup]
nixPkgs = ['nodejs_20', 'chromium']

[phases.install]
# Force fresh install - cache bust v2
cmds = ["rm -rf node_modules backend/node_modules frontend/node_modules && npm ci"]
cacheDirectories = []

[phases.build]
cmds = ["npm run build --workspace=etp-express-backend"]

[start]
cmd = "npm run migration:run:prod --workspace=etp-express-backend && npm run start:prod --workspace=etp-express-backend"

[variables]
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
PUPPETEER_EXECUTABLE_PATH = "/usr/bin/chromium"
NODE_ENV = "production"
