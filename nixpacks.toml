# Nixpacks configuration for Railway monorepo deployment
# Optimized for Node.js 20 LTS with system Chromium for Puppeteer
# Last updated: 2025-12-14 - Issue #670

[phases.setup]
nixPkgs = ['nodejs_20', 'chromium']

[phases.install]
cmds = ["npm ci"]

[phases.build]
cmds = ["npm run build --workspace=etp-express-backend"]

[start]
cmd = "npm run migration:run:prod --workspace=etp-express-backend && npm run start:prod --workspace=etp-express-backend"

[variables]
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
PUPPETEER_EXECUTABLE_PATH = "/usr/bin/chromium"
NODE_ENV = "production"
