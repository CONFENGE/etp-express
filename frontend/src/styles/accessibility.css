/**
 * Accessibility Styles - WCAG 2.1 AA Compliance
 *
 * This file provides accessibility enhancements following WCAG 2.1 Level AA guidelines.
 * It includes skip links, focus management, reduced motion support, and screen reader utilities.
 *
 * @see https://www.w3.org/WAI/WCAG21/quickref/
 */

/* ========================================
 * Skip Link - Keyboard Navigation
 * Allows keyboard users to skip to main content
 * ======================================== */
.skip-link {
  position: absolute;
  top: -100%;
  left: 50%;
  transform: translateX(-50%);
  z-index: var(--z-toast, 800);
  padding: var(--space-3, 12px) var(--space-6, 24px);
  background-color: var(--apple-accent, #007aff);
  color: #ffffff;
  font-weight: var(--font-weight-semibold, 600);
  font-size: var(--font-size-base, 15px);
  text-decoration: none;
  border-radius: var(--radius-apple, 10px);
  box-shadow: var(--shadow-lg, 0 8px 24px rgba(0, 0, 0, 0.12));
  transition:
    top var(--duration-apple, 200ms) var(--ease-apple, cubic-bezier(0.25, 0.1, 0.25, 1)),
    opacity var(--duration-apple, 200ms) var(--ease-apple, cubic-bezier(0.25, 0.1, 0.25, 1));
  opacity: 0;
}

.skip-link:focus {
  top: var(--space-4, 16px);
  opacity: 1;
  outline: none;
}

.skip-link:focus-visible {
  outline: 2px solid #ffffff;
  outline-offset: 2px;
}

/* ========================================
 * Focus Visible Enhancement
 * High-contrast focus indicators for all interactive elements
 * ======================================== */
:focus-visible {
  outline: 2px solid var(--apple-accent, #007aff);
  outline-offset: 2px;
}

/* Remove default outline when using mouse */
:focus:not(:focus-visible) {
  outline: none;
}

/* High contrast focus for buttons */
button:focus-visible,
[role="button"]:focus-visible,
a:focus-visible {
  outline: 2px solid var(--apple-accent, #007aff);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px var(--apple-accent-light, rgba(0, 122, 255, 0.1));
}

/* Focus within for form groups */
.focus-within-ring:focus-within {
  outline: 2px solid var(--apple-accent, #007aff);
  outline-offset: 2px;
}

/* ========================================
 * Touch Target Size
 * Minimum 44x44px for all interactive elements (WCAG 2.5.5)
 * ======================================== */
.touch-target {
  min-width: 44px;
  min-height: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Ensure clickable area for small icons */
.touch-target-expand {
  position: relative;
}

.touch-target-expand::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 44px;
  height: 44px;
  min-width: 44px;
  min-height: 44px;
}

/* ========================================
 * Screen Reader Only
 * Visually hidden but accessible to screen readers
 * ======================================== */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Not sr-only - make visible again */
.not-sr-only {
  position: static;
  width: auto;
  height: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* ========================================
 * Reduced Motion Support
 * Respects user's motion preferences (WCAG 2.3.3)
 * ======================================== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .animate-pulse,
  .animate-spin,
  .animate-bounce,
  .animate-fadeIn {
    animation: none !important;
  }

  /* Keep opacity transitions for usability */
  .transition-opacity {
    transition-duration: 150ms !important;
  }
}

/* ========================================
 * High Contrast Mode Support
 * Enhanced visibility for Windows High Contrast Mode
 * ======================================== */
@media (forced-colors: active) {
  /* Ensure borders are visible */
  button,
  input,
  select,
  textarea,
  [role="button"] {
    border: 1px solid ButtonText;
  }

  /* Focus indicator in high contrast */
  :focus-visible {
    outline: 3px solid Highlight;
    outline-offset: 2px;
  }

  /* Ensure links are identifiable */
  a {
    text-decoration: underline;
  }
}

/* ========================================
 * Live Region Styles
 * For dynamic content announcements
 * ======================================== */
[aria-live] {
  /* Prevent layout shift when content changes */
  contain: layout;
}

.aria-live-polite {
  /* Polite announcements wait for user pause */
}

.aria-live-assertive {
  /* Assertive announcements interrupt immediately */
}

/* ========================================
 * WCAG Contrast Utilities
 * Text colors that meet WCAG 2.1 AA contrast requirements
 * ======================================== */

/* Light mode - minimum 4.5:1 contrast ratio for normal text */
:root {
  /* Primary text on white background: #1d1d1f on #ffffff = 15.9:1 */
  --a11y-text-primary: #1d1d1f;

  /* Secondary text on white background: #48484a on #ffffff = 7.2:1 */
  --a11y-text-secondary: #48484a;

  /* Tertiary text on white background: #6e6e73 on #ffffff = 4.6:1 (AA pass) */
  --a11y-text-tertiary: #6e6e73;

  /* Error text: #c41e3a on #ffffff = 6.5:1 */
  --a11y-text-error: #c41e3a;

  /* Success text: #1d7a31 on #ffffff = 5.0:1 */
  --a11y-text-success: #1d7a31;

  /* Warning text: #7d5a00 on #ffffff = 5.8:1 */
  --a11y-text-warning: #7d5a00;

  /* Link text: #0056b3 on #ffffff = 7.3:1 */
  --a11y-text-link: #0056b3;
}

/* Dark mode - minimum 4.5:1 contrast ratio for normal text */
.dark {
  /* Primary text on dark background: #f5f5f7 on #1c1c1e = 14.9:1 */
  --a11y-text-primary: #f5f5f7;

  /* Secondary text on dark background: #a1a1a6 on #1c1c1e = 6.3:1 */
  --a11y-text-secondary: #a1a1a6;

  /* Tertiary text on dark background: #8e8e93 on #1c1c1e = 4.6:1 (AA pass) */
  --a11y-text-tertiary: #8e8e93;

  /* Error text: #ff6961 on #1c1c1e = 6.1:1 */
  --a11y-text-error: #ff6961;

  /* Success text: #5dd879 on #1c1c1e = 7.8:1 */
  --a11y-text-success: #5dd879;

  /* Warning text: #ffcc00 on #1c1c1e = 12.6:1 */
  --a11y-text-warning: #ffcc00;

  /* Link text: #64b5ff on #1c1c1e = 8.3:1 */
  --a11y-text-link: #64b5ff;
}

/* Utility classes for accessible text colors */
.text-a11y-primary {
  color: var(--a11y-text-primary);
}

.text-a11y-secondary {
  color: var(--a11y-text-secondary);
}

.text-a11y-tertiary {
  color: var(--a11y-text-tertiary);
}

.text-a11y-error {
  color: var(--a11y-text-error);
}

.text-a11y-success {
  color: var(--a11y-text-success);
}

.text-a11y-warning {
  color: var(--a11y-text-warning);
}

.text-a11y-link {
  color: var(--a11y-text-link);
}

/* ========================================
 * Form Accessibility
 * Enhanced form field accessibility
 * ======================================== */

/* Error state with high contrast */
.input-error {
  border-color: var(--a11y-text-error);
  box-shadow: 0 0 0 1px var(--a11y-text-error);
}

.input-error:focus-visible {
  outline-color: var(--a11y-text-error);
  box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.2);
}

/* Required field indicator */
.required-indicator {
  color: var(--a11y-text-error);
  font-weight: var(--font-weight-bold, 700);
}

/* Form field description */
.field-description {
  color: var(--a11y-text-secondary);
  font-size: var(--font-size-sm, 13px);
  margin-top: var(--space-1, 4px);
}

/* Error message styling */
.error-message {
  color: var(--a11y-text-error);
  font-size: var(--font-size-sm, 13px);
  margin-top: var(--space-1, 4px);
  display: flex;
  align-items: center;
  gap: var(--space-1, 4px);
}

/* ========================================
 * Interactive Element States
 * Clear visual feedback for all states
 * ======================================== */

/* Disabled state with sufficient contrast */
[disabled],
.disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Hover state enhancement */
.hover-highlight:hover {
  background-color: var(--apple-accent-light, rgba(0, 122, 255, 0.1));
}

/* Active/pressed state - standardized with button component (0.97) */
.active-scale:active {
  transform: scale(0.97);
}

/* ========================================
 * Selection and Text Contrast
 * ======================================== */
::selection {
  background-color: var(--apple-accent, #007aff);
  color: #ffffff;
}

.dark ::selection {
  background-color: var(--apple-accent, #0a84ff);
  color: #ffffff;
}

/* ========================================
 * Loading States Accessibility
 * Screen reader friendly loading indicators
 * ======================================== */
[aria-busy="true"] {
  cursor: wait;
}

.loading-overlay {
  position: relative;
}

.loading-overlay::after {
  content: "";
  position: absolute;
  inset: 0;
  background-color: rgba(255, 255, 255, 0.7);
  cursor: wait;
}

.dark .loading-overlay::after {
  background-color: rgba(28, 28, 30, 0.7);
}

/* ========================================
 * Dialog/Modal Accessibility
 * Focus trap and backdrop styling
 * ======================================== */
[role="dialog"][aria-modal="true"] {
  /* Ensure dialogs are above everything */
  z-index: var(--z-modal, 500);
}

/* Dialog backdrop */
.dialog-backdrop {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: var(--z-modal-backdrop, 400);
}

.dark .dialog-backdrop {
  background-color: rgba(0, 0, 0, 0.7);
}

/* ========================================
 * Table Accessibility
 * ======================================== */
table {
  border-collapse: collapse;
}

th {
  text-align: left;
  font-weight: var(--font-weight-semibold, 600);
}

/* Row hover for better tracking */
tbody tr:hover {
  background-color: var(--surface-secondary, #f5f5f7);
}

.dark tbody tr:hover {
  background-color: var(--surface-secondary, #2c2c2e);
}

/* Current row indicator */
tbody tr[aria-current="true"] {
  background-color: var(--apple-accent-light, rgba(0, 122, 255, 0.1));
}
