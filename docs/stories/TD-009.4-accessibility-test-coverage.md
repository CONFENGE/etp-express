# Story TD-009.4: Accessibility Test Coverage (axe-core)

## Metadata
| Campo | Valor |
|-------|-------|
| **Parent Story** | TD-009 (Code Quality - Schema Cleanup & System Hygiene) |
| **Priority** | P3 |
| **Estimated Effort** | 4h |
| **Area** | Frontend / QA |
| **Debts Addressed** | FE-10 |
| **Dependencies** | None |
| **Blocked By** | None |

---

## Description

Como equipe de QA, quero testes automatizados de acessibilidade (axe-core) cobrindo todas as ~30 paginas do frontend, para que violacoes WCAG 2.1 AA sejam detectadas automaticamente em CI e nao regridam em futuras mudancas.

---

## Technical Debt Addressed

### FE-10: Ausencia de testes axe-core por pagina (BAIXA - 4h)

**Contexto:** O ETP Express possui ~30 paginas React. Atualmente nao ha testes automatizados de acessibilidade cobrindo todas as paginas sistematicamente. Testes parciais existem mas nao cobrem o catalogo completo.

**Resolucao:**
1. Instalar `@axe-core/playwright` para testes E2E de acessibilidade
2. Criar suite de testes automatizados que navegam por cada pagina e executam scan axe-core
3. Configurar regras WCAG 2.1 AA como baseline
4. Integrar no pipeline CI (rodar apos testes E2E tradicionais)

---

## Paginas a Cobrir

### Publicas (sem auth)
1. `/login` — Pagina de login
2. `/register` — Pagina de registro
3. `/forgot-password` — Esqueci minha senha
4. `/reset-password` — Redefinir senha

### Dashboard & ETPs (autenticado)
5. `/dashboard` — Dashboard principal
6. `/etps` — Lista de ETPs
7. `/etps/new` — Criar novo ETP (wizard)
8. `/etps/:id` — Editor de ETP
9. `/etps/:id/sections` — Secoes do ETP

### Termos de Referencia
10. `/termos-referencia` — Lista de TRs
11. `/termos-referencia/:id` — Editor de TR

### Editais
12. `/editais` — Lista de editais
13. `/editais/:id` — Editor de edital

### Contratos
14. `/contratos` — Dashboard de contratos
15. `/contratos/:id` — Detalhe do contrato
16. `/contratos/:id/medicoes` — Medicoes
17. `/contratos/:id/ocorrencias` — Ocorrencias
18. `/contratos/:id/fiscalizacao` — Fiscalizacao

### Market Intelligence
19. `/pesquisas-precos` — Pesquisas de preco
20. `/analytics` — Market analytics dashboard

### Admin
21. `/admin` — Dashboard admin
22. `/admin/users` — Gestao de usuarios
23. `/admin/organizations` — Gestao de organizacoes
24. `/admin/domains` — Gestao de dominios
25. `/admin/branding` — White-label config
26. `/admin/feature-flags` — Feature flags

### Perfil & Configuracoes
27. `/profile` — Perfil do usuario
28. `/settings` — Configuracoes
29. `/api-keys` — Gestao de API keys

### Outros
30. `/404` — Pagina nao encontrada
31. `/500` — Erro interno (ErrorBoundary)

---

## Acceptance Criteria

- [ ] Dependencia `@axe-core/playwright` instalada e configurada
- [ ] Suite de testes E2E de acessibilidade criada em `e2e/accessibility/`
- [ ] Todas as ~30 paginas publicas e autenticadas cobertas por scan axe-core
- [ ] Regras WCAG 2.1 AA configuradas como baseline minimo
- [ ] Violacoes criticas (level A) fazem o teste falhar
- [ ] Violacoes moderadas (level AA) sao reportadas como warnings
- [ ] Relatorio de acessibilidade gerado automaticamente (HTML ou JSON)
- [ ] Testes integrados no pipeline CI (rodam em `npm run test:e2e`)
- [ ] Documentacao de como interpretar resultados e corrigir violacoes
- [ ] Nenhuma violacao critica nova introduzida (baseline limpo)

---

## Test Plan

### Setup
1. Instalar: `npm install -D @axe-core/playwright`
2. Criar helper function `checkAccessibility(page)` reutilizavel
3. Configurar regras: WCAG 2.1 AA, excluindo regras experimentais

### Estrutura dos Testes
```typescript
// e2e/accessibility/pages.spec.ts
test.describe('Accessibility - WCAG 2.1 AA', () => {
  test('Login page has no critical violations', async ({ page }) => {
    await page.goto('/login');
    const results = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa'])
      .analyze();
    expect(results.violations.filter(v => v.impact === 'critical')).toHaveLength(0);
  });
  // ... repeat for each page
});
```

### Cobertura
- Paginas publicas: scan sem autenticacao
- Paginas autenticadas: login via fixture antes do scan
- Paginas admin: login com SYSTEM_ADMIN
- Modais e dialogs: abrir antes do scan (CreateETP, Export, etc.)

### Relatorio
- Gerar `accessibility-report.json` com resultados
- Em CI: publicar como artifact
- Localmente: imprimir sumario no terminal

---

## Files Affected

| Arquivo | Mudanca |
|---------|---------|
| `package.json` (root ou frontend) | Adicionar `@axe-core/playwright` |
| `e2e/accessibility/pages.spec.ts` | **NOVO** - Suite de testes axe-core |
| `e2e/accessibility/helpers.ts` | **NOVO** - Helper functions reutilizaveis |
| `e2e/playwright.config.ts` | Adicionar projeto de acessibilidade (opcional) |
| `docs/guides/accessibility-testing.md` | **NOVO** - Guia de testes de acessibilidade |

---

## Notas Tecnicas

- **Nota sobre FE-04 (SkipLink em ingles):** Ja resolvido em TD-007 (PR #1722). O SkipLink ja usa "Pular para o conteudo principal" (verificado em `frontend/src/components/common/SkipLink.tsx`).
- Os testes axe-core podem detectar violacoes pre-existentes. A primeira execucao servira como baseline — violacoes existentes devem ser triadas e priorizadas separadamente.
- Paginas que requerem dados (ex: editor de ETP com secoes) precisam de seeding ou mocking para renderizar completamente.

---

*Story criada em 2026-02-12 por @pm (Morgan) - AIOS v3.10.0*
